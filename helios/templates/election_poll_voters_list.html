{% extends "election_page.html" %}
{% load i18n zeus_tags %} 

{% block content %}

<div class="row" style="padding-bottom: 8px;">
  <div class="col-6">
    <table class="table table-striped table-hover">
      <tbody>
        <tr>
          <td>{% trans "Total voters count" %}:</td>
          <td>{{ voters_count }}</td>
        </tr>
        <tr>
          <td>{% trans "Excluded Voters" %}:</td>
          <td>{{nr_voters_excluded}}</td>
        </tr>
        <tr>
          <td>{% trans "Votes cast" %}:</td>
          <td>{{ voted_count }}</td>
        </tr>
      </tbody>
    </table>
    <form action="{{ request.get_full_path }}#voters-table" method="GET" class="d-flex align-items-center">
      <label class="me-2">{% trans "Filter" %}:</label>
      <input id="form" class="form-control me-2" name="q" type="text" value="{{ q }}"/>
      
      {% if q %}
        <span class="me-2">
          {% blocktrans count voters.count as voters_count %}
            {{ voters_count }} result found
          {% plural %}
            {{ voters_count }} results found
          {% endblocktrans %}
        </span>
      {% endif %}
      
      <input class="btn btn-outline-primary me-2" type="submit" value="✓"/>
      <a class="btn btn-outline-danger" href="{% url "election_poll_voters" election.uuid poll.uuid %}#voters-table">✗</a>
    </form>
  </div>
  <div class="col-6">
    {% if admin %}
      <div class="d-grid gap-2">
        {% if poll.feature_can_add_voter %}
          <a class="btn btn-primary btn-lg" href="{% url "election_poll_voters_upload" election.uuid poll.uuid%}">{% trans "Import voters" %}</a>
        {% endif %}
        {% if poll.feature_can_send_voter_mail %}
          <a class="btn btn-primary btn-lg" href="{% url "election_poll_voters_email" election.uuid poll.uuid %}{% if q %}?q={{q|escape|escape_plus}}{% endif %}">{% trans "Notify voters" %}</a>
        {% endif %}
          <a class="btn btn-secondary btn-lg" href="{% url "election_poll_voters_csv" election.uuid poll.uuid poll.short_name%}{% if q %}?q={{q|escape|escape_plus}}{% endif %}">{% trans "Export voter list to CSV" %}</a>
        {% if poll.feature_can_clear_voters %}
          <a class="btn btn-danger btn-lg" href="{% url "election_poll_voters_clear" election.uuid poll.uuid%}">{% trans "Delete all voters" %}</a>            
        {% endif %}
        </div>
      </div>
      {% endif %}
  </div>
</div>



<table class="table table-striped table-hover" id="elections-table">
  <thead class="table-dark">
    <tr>
      {% for key, value  in voter_table_headers_iter %}
        <th>
          {% if key != 'actions' %}
          <a style="color: white; text-decoration-line: none;" href="?order={{key}}{% complete_get_parameters request.GET key "voter_login_id" %}" 
             class="{{ ordering_cls }}">{{ value }}</a>
          {% else %}
            {{ value }}
          {% endif %}
        </th>
      {% endfor %}
    </tr>
  </thead>
  <tbody>
  {% for voter in voters %}
  <tr>
    <td>
      {{ voter.voter_login_id }}
    </td>
    <td>
      {{ voter.voter_email_display }}
    </td>
    <td>
      {{ voter.voter_surname }}
    </td>
    <td>
      {{ voter.voter_name }} 
    </td>
    <td>
        {% if voter.voter_fathername %}{{ voter.voter_fathername }}{% endif %}
    </td>
    <td>
        {% if voter.voter_mobile %}{{ voter.voter_mobile }}{% endif %}
    </td>
    {% if display_weight_col and 'voter_weight' in voter_table_headers %}
    <td>
        {{ voter.voter_weight }}
    </td>
    {% endif %}
    {% if user.is_manager or 'cast_votes__id' in voter_table_headers %}
    <td>
      {% if voter.voted %}
      {% trans "YES" %} {% if voter.excluded_at %}<b style="color:red">{% trans "(Excluded)" %}</b>{% endif %}
      {% else %}
      {% trans "NO" %}
      {% endif %}

    </td>
    {% endif %}
    {% if admin %}
        {% if user.is_manager or 'last_booth_invitation_send_at' in voter_table_headers %}
        <td>
        {{ voter.last_booth_invitation_send_at }}
        </td>
        {% endif %}
        {% if user.is_manager or 'last_visit' in voter_table_headers %}
        <td>
        {{ voter.last_visit }}
        </td>
        {% endif %}
    {% endif %}

    {% if not user.is_manager and 'excluded_at' in voter_table_headers %}
    <td>
      {% if voter.excluded_at %}
      {% trans "YES" %}
      {% else %}
      {% trans "NO" %}
      {% endif %}
    </td>
    {% endif %}
{% if admin %}
      <td>
<div class="dropdown">
  <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
    {% trans "Voter actions" %}&nbsp;
  </button>
  <ul class="dropdown-menu">
    {% if poll.feature_can_send_voter_mail %}
      <li><a class="dropdown-item" href="{% url "election_poll_voter_email" election.uuid poll.uuid voter.uuid %}">{% trans "Notify voters" %}</a></li>
    {% endif %}
    {% if not voter.voted and poll.feature_can_delete_voter %}
      <li><a class="dropdown-item" href="{% url "election_poll_voter_delete" election.uuid poll.uuid voter.uuid %}">{% trans "Delete voter" %}</a></li>
    {% endif %}
    {% if not voter.excluded_at and poll.feature_can_exclude_voter %}
      <li><a class="dropdown-item" href="{% url "election_poll_voter_exclude" election.uuid poll.uuid voter.uuid%}">{% trans "Exclude voter" %}</a></li>
    {% endif %}
  </ul>
</div>
</div>
</td>
{% endif %}
</tr>
{% empty %}
<tr><td colspan=10>{% trans "No voters added" %}</td></tr>
{% endfor %}
</tbody>
</table>
{% endblock %}
